@page
@model dynamic
@{
    Layout = "_Layout";
    ViewData["Title"] = "Login";
}

<h2>Login</h2>

<form id="loginForm">
    <div><label>Email</label><input type="email" id="email" required /></div>
    <div><label>Password</label><input type="password" id="password" required /></div>
    <button type="submit">Login</button>
</form>

<p id="msg" style="color:red"></p>

<script type="module">
    import { login, currentRole } from "/js/firebase-auth.js";

    const roleToUrl = {
      Admin: "/Dashboard/Admin",
      ProjectManager: "/Dashboard/ProjectManager",
      Contractor: "/Dashboard/Contractor",
      Client: "/Dashboard/Client"
    };

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const em  = email.value;
      const pwd = password.value;
      const msg = document.getElementById("msg");
      msg.textContent = "";
      try {
        const user = await login(em, pwd);
        const role = await currentRole(user);
        const url  = roleToUrl[role] ?? "/Dashboard/Client";
        window.location.href = url;
      } catch (err) {
        msg.textContent = err.message;
      }
    });
</script>
