@page
@model dynamic
@{
    Layout = "_Layout";
    ViewData["Title"] = "Register";
}
<h2>Register</h2>

<form id="regForm">
    <div><label>Display Name</label><input type="text" id="displayName" required /></div>
    <div><label>Email</label><input type="email" id="email" required /></div>
    <div><label>Password</label><input type="password" id="password" required /></div>
    <button type="submit">Create Account</button>
</form>

<p>New users are automatically <strong>Client</strong> role. Admins can upgrade roles via the Firebase Admin tool.</p>
<p id="msg" style="color:red"></p>

<script type="module">
    import { register, currentRole } from "/js/firebase-auth.js";

    document.getElementById("regForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const dn = displayName.value, em = email.value, pw = password.value;
      const msg = document.getElementById("msg");
      msg.textContent = "";
      try {
        const user = await register(em, pw, dn);
        const role = await currentRole(user); // should be Client by default
        if (role === "Admin") window.location.href = "/Dashboard/Admin";
        else window.location.href = "/Dashboard/Client";
      } catch (err) {
        msg.textContent = err.message;
      }
    });
</script>
